<div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
  <div class="pb-6">
    <h1 class="text-3xl font-bold text-gray-900">着用カレンダー</h1>
  </div>
  
  <%# ヘッダーとボタン %>
  <div class="flex justify-between items-center mb-4">
    <div class="flex items-center space-x-2">
      <%# 前週へ (月曜始まりに合わせて start_date を調整) %>
      <%= link_to actual_outfits_path(start_date: @week_start - 7.days), class: "text-gray-500 hover:text-gray-700 transition duration-150" do %>
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
      <% end %>
      
      <%# 現在の週の範囲 %>
      <h2 class="text-2xl font-semibold text-amber-800">
        <%= l @week_start, format: :short_date %> - <%= l @week_end, format: :short_date %>
      </h2>
      
      <%# 翌週へ (月曜始まりに合わせて start_date を調整) %>
      <%= link_to actual_outfits_path(start_date: @week_start + 7.days), class: "text-gray-500 hover:text-gray-700 transition duration-150" do %>
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
      <% end %>
    </div>

    <%# アクションボタン %>
    <div class="space-x-4">
      
      <%# クローゼットに戻るボタン %>
      <%= link_to "クローゼット", authenticated_root_path, class: "text-gray-600 hover:text-amber-700 px-3 py-2 rounded-md text-sm font-medium transition duration-150 border border-gray-300" %>
      
      <%# 簡単に今日の記録を作成できるボタン %>
      <%= link_to "今日の記録を追加", new_actual_outfit_path(worn_on: Date.current), class: "bg-green-600 text-white hover:bg-green-700 px-3 py-2 rounded-md text-sm font-medium transition duration-150 shadow-md" %>
    </div>
  </div>

  <%# ==== カレンダー本体 ==== %>
  <div class="bg-white p-6 rounded-xl shadow-xl">
    <div class="grid grid-cols-7 text-center font-bold text-lg mb-2 border-b-2 border-gray-200">
      <%# 月曜日始まりに合わせて曜日の並びを修正 %>
      <div class="py-2 text-gray-700">月</div>
      <div class="py-2 text-gray-700">火</div>
      <div class="py-2 text-gray-700">水</div>
      <div class="py-2 text-gray-700">木</div>
      <div class="py-2 text-gray-700">金</div>
      <div class="py-2 text-blue-600">土</div>
      <div class="py-2 text-red-600">日</div>
    </div>

    <div class="grid grid-cols-7 gap-1">
      <% (@week_start..@week_end).each do |date| %>
        <%# 縦長にするため、min-h-[600px] クラスで高さを確保 %>
        <div class="<%= 'bg-gray-100' if date.today? %> border border-gray-200 rounded-lg p-3 relative hover:bg-gray-50 transition duration-100 min-h-[600px]"> 
          <%# 日付と曜日 %>
          <div class="text-right text-lg font-semibold mb-2 <%= 'text-red-600' if date.sunday? %> <%= 'text-blue-600' if date.saturday? %>">
            <%= date.day %>
          </div>

          <%# その日の着用記録を検索 %>
          <% daily_outfits = @outfits_by_date[date] || [] %>

          <%# 着用記録の表示 %>
          <% if daily_outfits.present? %>
            <% daily_outfits.each do |outfit| %>
              <div class="bg-amber-100 border border-amber-300 rounded-md p-2 mb-2 text-sm">
                <p class="font-medium text-amber-800">着用: <%= outfit.item&.name %></p>
                <p class="text-gray-700 truncate">メモ: <%= outfit.impression.truncate(10) %></p> 
                
                <%# 記録削除ボタン %>
                <%= button_to "削除", actual_outfit_path(outfit), method: :delete, data: { confirm: "この記録を削除しますか？" }, class: "text-xs text-red-500 hover:text-red-700 inline-block bg-transparent border-none p-0 cursor-pointer" %>
              </div>
            <% end %>
          <% else %>
            <p class="text-gray-400 text-sm">記録なし</p>
          <% end %>

          <%# 記録追加ボタン (右下に配置) %>
          <div class="absolute bottom-2 right-2">
            <%= link_to new_actual_outfit_path(worn_on: date), class: "text-green-600 hover:text-green-800" do %>
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>