<%# === 着用記録 週間カレンダー === %>

<div class="elegant-font py-10 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto">
  <div class="bg-white p-6 rounded-xl shadow-2xl border border-gray-100">

    <div class="flex flex-col sm:flex-row justify-between items-center mb-6 border-b border-amber-100 pb-4">
      <h1 class="text-3xl font-extrabold text-gray-900 tracking-tight mb-4 sm:mb-0">
        着用カレンダー
      </h1>
      <div class="flex space-x-3">
        <%= link_to "クローゼット", authenticated_root_path, class: "text-gray-600 hover:text-amber-700 px-3 py-2 rounded-md text-sm font-medium transition duration-150 border border-gray-300" %>
        <%# 簡単に今日の記録を作成できるボタン %>
        <%= link_to "今日の記録を追加", new_actual_outfit_path(worn_on: Date.current), class: "bg-green-600 text-white hover:bg-green-700 px-3 py-2 rounded-md text-sm font-medium transition duration-150 shadow-md" %>
      </div>
    </div>

    <%# === 週ナビゲーション === %>
    <div class="flex justify-between items-center bg-amber-50 p-3 rounded-lg mb-6 shadow-inner">
      <%# 前週へ %>
      <%= link_to actual_outfits_path(start_date: @week_start.ago(1.week)), class: "p-2 rounded-full hover:bg-amber-100 transition duration-150" do %>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-amber-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      <% end %>
      
      <%# 現在の週の範囲 %>
      <h2 class="text-2xl font-semibold text-amber-800">
        <%= l @week_start, format: :short_date %> - <%= l @week_end, format: :short_date %>
      </h2>
      
      <%# 翌週へ %>
      <%= link_to actual_outfits_path(start_date: @week_start.since(1.week)), class: "p-2 rounded-full hover:bg-amber-100 transition duration-150" do %>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-amber-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      <% end %>
    </div>
    
    <%# === 週間カレンダー本体 === %>
    <div class="grid grid-cols-7 text-center text-sm font-medium mb-2">
      <%# 曜日ヘッダー %>
      <% Date::ABBR_DAYNAMES.each_with_index do |day, index| %>
        <%# 日曜日は赤 (index 0), 土曜日は青 (index 6) %>
        <div class="font-bold border-b-2 pb-2
          <%= index == 0 ? "text-red-600 border-red-200" : (index == 6 ? "text-blue-600 border-blue-200" : "text-gray-700 border-gray-200") %>">
          <%= day %>
        </div>
      <% end %>
    </div>

    <div class="grid grid-cols-7 gap-3">
      <%# 日付のセル %>
      <% (@week_start..@week_end).each do |date| %>
        <% is_today = (date == Date.current) %>
        <div class="min-h-48 p-3 bg-gray-50 rounded-xl border-2 <%= is_today ? 'border-amber-500 shadow-xl bg-amber-50' : 'border-gray-200 hover:border-amber-300' %> transition duration-150">
          
          <%# 日付番号と記録ボタン %>
          <div class="flex justify-between items-start mb-2">
            <span class="text-xl font-extrabold <%= is_today ? 'text-amber-800' : 'text-gray-800' %>">
              <%= date.day %>
            </span>
            
            <%# 記録ボタン (今日以前のみ) %>
            <% if date <= Date.current %>
              <%= link_to new_actual_outfit_path(worn_on: date), class: "text-xs text-green-600 hover:text-white bg-green-100 hover:bg-green-600 rounded-full p-2 leading-none font-medium transition duration-150 shadow-sm" do %>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
              <% end %>
            <% else %>
              <%# 将来の予定表示用にスペースを確保（後でPlannedOutfitのボタンを配置） %>
              <div class="h-8 w-8"></div> 
            <% end %>
          </div>

          <%# 着用アイテム一覧 %>
          <div class="mt-1 space-y-1 overflow-y-auto max-h-36">
            <h3 class="text-xs font-semibold text-gray-500 border-b border-gray-200 mb-1">
              着用実績
            </h3>
            <% if (@outfits_by_date[date] || []).any? %>
              <% (@outfits_by_date[date] || []).each do |log| %>
                <div class="group flex items-center justify-between bg-white hover:bg-gray-100 rounded-lg p-1 transition duration-150 shadow-sm border border-gray-100">
                  <%= link_to item_path(log.item), title: log.item.name, class: "flex-grow text-xs text-gray-800 truncate cursor-pointer font-medium" do %>
                    <%= log.item.name %>
                  <% end %>
                  
                  <%# 削除ボタン %>
                  <%= button_to actual_outfit_path(log), method: :delete, data: { turbo_confirm: "#{log.item.name} の記録を削除しますか？" }, class: "flex-shrink-0 text-red-500 hover:text-red-700 ml-1 leading-none p-0.5 rounded-full hover:bg-red-100 transition duration-150" do %>
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  <% end %>
                </div>
              <% end %>
            <% else %>
              <p class="text-xs text-gray-400 italic">記録なし</p>
            <% end %>
          </div>
          
          <%# 将来の拡張: 予定とアポイントメントを表示するスペースを確保 %>
          <div class="mt-3">
             <h3 class="text-xs font-semibold text-gray-500 border-b border-gray-200 mb-1">
              予定 (Coming Soon)
            </h3>
            <p class="text-xs text-gray-300 italic">会う人/予定の服</p>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>