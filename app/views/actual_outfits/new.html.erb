<%# --- 新しい着用記録の作成フォーム --- %>

<div class="max-w-4xl mx-auto py-6 sm:px-6 lg:px-8">
  <div class="bg-white p-8 rounded-xl shadow-2xl">
    <h1 class="text-3xl font-bold text-gray-900 mb-6">新しい着用記録</h1>
    
    <%# エラーメッセージの表示 %>
    <%= render "shared/error_messages", resource: @actual_outfit %>

    <%= form_with(model: @actual_outfit, url: actual_outfits_path, local: true) do |form| %>
      
      <%# --- 1. 着用日 (Hidden/Readonly) --- %>
      <div class="mb-6">
        <label class="block text-sm font-medium text-gray-700">着用日</label>
        <p class="text-xl font-bold text-amber-700">
          <%= l @actual_outfit.worn_on, format: :long %>
        </p>
        <%= form.hidden_field :worn_on %>
      </div>

      <%# --- 2. 時間帯の選択 (Time Slot) --- %>
      <div class="mb-6">
        <%= form.label :time_slot, "時間帯", class: "block text-sm font-medium text-gray-700" %>
        <%# コントローラーで準備された @time_slot_options を使用 %>
        <%= form.select :time_slot, @time_slot_options, { prompt: "時間帯を選択してください" }, class: "mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-amber-500 focus:border-amber-500 sm:text-sm rounded-md shadow-sm" %>
      </div>

      <%# --- 3. アイテムの選択 --- %>
      <div class="mb-6">
        <%= form.label :item_id, "アイテム", class: "block text-sm font-medium text-gray-700" %>
        <%# @items を使用し、requiredを付与 %>
        <%= form.select :item_id, @items.map { |i| [i.name, i.id] }, { prompt: "アイテムを選択してください" }, 
              { required: true, class: "mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-amber-500 focus:border-amber-500 sm:text-sm rounded-md shadow-sm" } %>
        <p class="mt-2 text-sm text-gray-500">※ 現在の仕様では、一つの記録で一つのアイテムのみ選択できます。</p>
      </div>

      <%# --- 4. メモ/感想 (Impression) --- %>
      <div class="mb-8">
        <%= form.label :impression, "メモ・感想", class: "block text-sm font-medium text-gray-700" %>
        <%= form.text_area :impression, rows: 4, placeholder: "着用した時の天気、気分、コメントなどを記入してください。", class: "mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-amber-500 focus:border-amber-500 sm:text-sm" %>
      </div>

      <%# --- 5. 送信ボタン --- %>
      <div class="flex justify-end space-x-4">
        <%# キャンセルボタンは、タイムラインビューに戻るように設定 %>
        <%# start_dateは月曜始まりに統一 %>
        <%= link_to 'キャンセル', actual_outfits_path(start_date: @actual_outfit.worn_on.beginning_of_week(:monday)), class: "bg-gray-300 text-gray-800 hover:bg-gray-400 px-4 py-2 rounded-md font-medium transition duration-150 shadow-md" %>
        <%= form.submit "記録を保存", class: "bg-amber-600 text-white hover:bg-amber-700 px-4 py-2 rounded-md font-medium transition duration-150 shadow-md cursor-pointer" %>
      </div>
    <% end %>
  </div>
</div>