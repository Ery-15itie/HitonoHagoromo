<div class="max-w-xl mx-auto p-4 sm:p-6 lg:p-8 bg-white shadow-xl rounded-xl">
  <h1 class="text-3xl font-extrabold text-gray-900 mb-6 border-b pb-3">着用実績の記録</h1>

  <%= form_with(model: @actual_outfit, url: create_actual_outfits_path, class: "space-y-6") do |form| %>
    <%# --- 全体エラー表示 --- %>
    <% if @actual_outfit.errors.any? %>
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative">
        <p class="font-bold">登録に失敗しました。以下をご確認ください:</p>
        <ul class="list-disc ml-5 mt-2">
          <% @actual_outfit.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <!-- 1. 着用日 -->
    <div class="field">
      <%= form.label :worn_on, "着用日", class: "block text-sm font-medium text-gray-700" %>
      <%= form.date_field :worn_on, required: true, class: "mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500" %>
    </div>

    <!-- 2. 時間帯 -->
    <div class="field">
      <%= form.label :time_slot, "時間帯", class: "block text-sm font-medium text-gray-700" %>
      <%= form.select :time_slot, @time_slot_options, { prompt: "選択してください" }, required: true, class: "mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500" %>
    </div>
    
    <!-- 3. アイテム -->
    <div class="field">
      <%= form.label :item_id, "着用アイテム", class: "block text-sm font-medium text-gray-700" %>
      <% if @items.any? %>
        <%= form.collection_select :item_id, @items, :id, :name, { prompt: "選択してください" }, required: true, class: "mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500" %>
      <% else %>
        <p class="mt-1 text-red-500">アイテムが登録されていません。アイテム一覧から登録してください。</p>
      <% end %>
    </div>

    <!-- 4. 会う人 (Contact) -->
    <div class="field">
      <%= form.label :contact_id, "会った人 (オプション)", class: "block text-sm font-medium text-gray-700" %>
      <% if @contacts.any? %>
        <%= form.collection_select :contact_id, @contacts, :id, :name, { prompt: "会った人を選択 (重複チェックに使用)" }, allow_nil: true, class: "mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500" %>
      <% else %>
        <p class="mt-1 text-sm text-gray-500">会う人が登録されていません。先に<a href="<%= contacts_path %>" class="text-indigo-600 hover:text-indigo-900 underline">会う人の管理ページ</a>から登録してください。</p>
        <%= form.hidden_field :contact_id, value: nil %>
      <% end %>
    </div>

    <!-- 5. メモ/感想 -->
    <div class="field">
      <%= form.label :impression, "メモ・感想 (任意)", class: "block text-sm font-medium text-gray-700" %>
      <%= form.text_area :impression, rows: 3, class: "mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2 focus:ring-indigo-500 focus:border-indigo-500" %>
    </div>

    <%# === 6. 重複無視チェックボックス (新規追加) === %>
    <div class="field pt-3 border-t">
      <%= form.check_box :ignore_duplication, class: "h-4 w-4 text-red-600 border-gray-300 rounded" %>
      <%= form.label :ignore_duplication, "重複警告を無視して強制的に登録する", class: "ml-2 text-sm font-medium text-red-600" %>
      <p class="text-xs text-gray-500 mt-1">※ 既にこの人に同じ服を着ていた記録がある場合に使用します。</p>
    </div>

    <div class="actions pt-4">
      <%= form.submit "実績を記録する", class: "w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg shadow transition duration-150 ease-in-out cursor-pointer" %>
    </div>
  <% end %>

  <div class="mt-8 text-center">
    <%= link_to "タイムテーブルに戻る", actual_outfits_calendar_path, class: "text-sm text-gray-500 hover:text-gray-700 font-medium transition duration-150" %>
  </div>
</div>