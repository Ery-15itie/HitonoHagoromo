<%# --- Global Styles & Fonts Import --- %>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Shippori+Mincho:wght@600&display=swap" rel="stylesheet">

<div class="min-h-screen bg-[#FDFBF7] text-slate-700 font-sans selection:bg-amber-100 selection:text-amber-900">
  
  <%# --- Header --- %>
  <header class="w-full py-4 px-4 sm:py-6 sm:px-6 flex flex-col md:flex-row justify-between items-center max-w-6xl mx-auto z-50 relative gap-4 md:gap-0 bg-[#FDFBF7]/90 backdrop-blur-sm sticky top-0 md:static border-b md:border-none border-stone-100">
    
    <%# „É≠„Ç¥ %>
    <%= link_to root_path, class: "flex items-center gap-2 text-indigo-950 hover:opacity-80 transition duration-300" do %>
      <span class="text-2xl sm:text-3xl filter drop-shadow-sm">üëò</span>
      <span class="text-2xl sm:text-3xl font-bold tracking-widest" style="font-family: 'Shippori Mincho', serif;">
        „Éí„Éà„Éé„Éè„Ç¥„É≠„É¢
      </span>
    <% end %>

    <%# „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ %>
    <nav class="flex items-center gap-4 sm:gap-6 text-xs sm:text-sm font-bold text-indigo-900 overflow-x-auto w-full md:w-auto justify-center md:justify-end py-2 no-scrollbar">
      <%= link_to "„Ç´„É¨„É≥„ÉÄ„Éº", calendar_path, class: "whitespace-nowrap hover:text-amber-700 transition" %>
      <%= link_to "‰ºö„ÅÜ‰∫∫„ÅÆÁÆ°ÁêÜ", contacts_path, class: "whitespace-nowrap hover:text-amber-700 transition" %>
      <%= link_to "„ÇØ„É≠„Éº„Çº„ÉÉ„Éà", items_path, class: "whitespace-nowrap text-amber-700 border-b-2 border-amber-700" %>
      
      <% if user_signed_in? %>
        <%= button_to "„É≠„Ç∞„Ç¢„Ç¶„Éà", destroy_user_session_path, method: :delete, class: "whitespace-nowrap bg-red-400 text-white px-3 py-1.5 rounded-full hover:bg-red-500 transition shadow-sm cursor-pointer border-none font-bold" %>
      <% else %>
        <%= link_to "„É≠„Ç∞„Ç§„É≥", new_user_session_path, class: "whitespace-nowrap bg-indigo-600 text-white px-3 py-1.5 rounded-full hover:bg-indigo-700 transition" %>
      <% end %>
    </nav>
  </header>

  <main class="max-w-6xl mx-auto px-4 sm:px-6 py-4 sm:py-8">
    
    <%# „Éï„É©„ÉÉ„Ç∑„É•„É°„ÉÉ„Çª„Éº„Ç∏ %>
    <% if notice %>
      <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 mb-6 rounded shadow-sm animate-fade-in-down" role="alert">
        <p class="font-bold">„ÅäÁü•„Çâ„Åõ</p>
        <p><%= notice %></p>
      </div>
    <% end %>
    <% if alert %>
      <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded shadow-sm animate-fade-in-down" role="alert">
        <p class="font-bold">Ê≥®ÊÑè</p>
        <p><%= alert %></p>
      </div>
    <% end %>

    <div class="flex flex-col lg:flex-row gap-6 lg:gap-8">
      
      <%# --- Left Sidebar („É°„Éã„É•„Éº„ÉªÊ§úÁ¥¢) --- %>
      <aside class="w-full lg:w-1/4 space-y-4 lg:space-y-6">
        
        <%# [„Çπ„Éû„ÉõÁî®] Êñ∞Ë¶èÁôªÈå≤„Éú„Çø„É≥„Å†„Åë„ÅØÂ∏∏„Å´‰∏ÄÁï™‰∏ä„Å´Ë°®Á§∫ %>
        <div class="flex gap-2 lg:block">
          <%= link_to new_item_path, class: "flex-1 block w-full text-center bg-amber-600 hover:bg-amber-700 text-white font-bold py-3 px-4 rounded-xl transition shadow-md flex items-center justify-center gap-2" do %>
             <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
             Êñ∞„Åó„ÅèÁôªÈå≤
          <% end %>

          <%# [„Çπ„Éû„ÉõÁî®] „Éï„Ç£„É´„Çø„Éº„Éà„Ç∞„É´„Éú„Çø„É≥ (PC„Åß„ÅØÈùûË°®Á§∫) %>
          <button type="button" onclick="toggleMobileFilter()" class="lg:hidden flex-none bg-white text-slate-600 border border-slate-200 font-bold py-3 px-4 rounded-xl shadow-sm flex items-center gap-2 hover:bg-slate-50">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path></svg>
            <span class="text-xs">Êù°‰ª∂</span>
          </button>
        </div>

        <%# „Ç´„É¨„É≥„ÉÄ„Éº„É™„É≥„ÇØ (PC„Åß„ÅØ„Çµ„Ç§„Éâ„Éê„Éº„ÄÅ„Çπ„Éû„Éõ„Åß„ÅØ„Éà„Ç∞„É´ÂÜÖ„Å´ÁßªÂãï„Åó„Å¶„ÇÇËâØ„ÅÑ„Åå„ÄÅ‰ªäÂõû„ÅØ„É°„Ç§„É≥„Ç¢„ÇØ„Ç∑„Éß„É≥„Å®„Åó„Å¶Ë°®Á§∫) %>
        <div class="hidden lg:block">
          <%= link_to calendar_path, class: "block w-full text-center bg-white border-2 border-slate-200 text-slate-600 font-bold py-3 px-4 rounded-xl hover:bg-slate-50 transition" do %>
            üìÖ ÁùÄÁî®„Ç´„É¨„É≥„ÉÄ„Éº
          <% end %>
        </div>

        <%# ‚ñº‚ñº‚ñº „Éï„Ç£„É´„Çø„Éª‰∏¶„Å≥Êõø„Åà„Ç®„É™„Ç¢ („Çπ„Éû„Éõ„Åß„ÅØÂàùÊúüÈùûË°®Á§∫) ‚ñº‚ñº‚ñº %>
        <div id="filter-section" class="hidden lg:block space-y-4 lg:space-y-6">
          
          <%# ‰∏¶„ÅπÊõø„Åà %>
          <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
            <h3 class="font-bold text-slate-500 mb-3 text-sm flex items-center gap-2 border-b border-slate-100 pb-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"></path></svg>
              ‰∏¶„ÅπÊõø„Åà
            </h3>
            <ul class="space-y-1 text-sm">
              <% 
                sort_options = {
                  'newest' => 'Êñ∞„Åó„ÅÑÈ†Ü',
                  'oldest' => 'Âè§„ÅÑÈ†Ü',
                  'price_low' => '‰æ°Ê†º„ÅåÂÆâ„ÅÑÈ†Ü',
                  'price_high' => '‰æ°Ê†º„ÅåÈ´ò„ÅÑÈ†Ü'
                }
              %>
              <% sort_options.each do |key, label| %>
                <% is_active = (params[:sort] == key) || (params[:sort].nil? && key == 'newest') %>
                <li>
                  <%= link_to request.params.merge(sort: key), class: "block p-2 rounded transition #{is_active ? 'bg-amber-50 text-amber-800 font-bold ring-1 ring-amber-200' : 'text-slate-600 hover:bg-slate-50'}" do %>
                    <div class="flex items-center justify-between">
                      <span><%= label %></span>
                      <% if is_active %>
                        <span class="text-amber-500">‚óè</span>
                      <% end %>
                    </div>
                  <% end %>
                </li>
              <% end %>
            </ul>
          </div>

          <%# „Ç´„ÉÜ„Ç¥„É™„Éï„Ç£„É´„Çø %>
          <div class="bg-white p-5 rounded-2xl shadow-sm border border-slate-100">
             <h3 class="font-bold text-slate-500 mb-3 text-sm flex items-center gap-2 border-b border-slate-100 pb-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path></svg>
              „Ç´„ÉÜ„Ç¥„É™
            </h3>
            <ul class="space-y-1 text-sm">
               <li>
                 <%= link_to "„Åô„Åπ„Å¶Ë°®Á§∫", request.params.merge(category_id: nil), class: "block px-2 py-2 rounded #{params[:category_id].blank? ? 'text-amber-800 font-bold bg-amber-50' : 'text-slate-600 hover:text-amber-700 hover:bg-slate-50'}" %>
               </li>
               <% Category.all.each do |cat| %>
                 <li>
                   <%= link_to cat.name, request.params.merge(category_id: cat.id), class: "block px-2 py-2 rounded #{params[:category_id].to_s == cat.id.to_s ? 'text-amber-800 font-bold bg-amber-50' : 'text-slate-600 hover:text-amber-700 hover:bg-slate-50'}" %>
                 </li>
               <% end %>
            </ul>
          </div>
        </div>
      </aside>

      <%# --- Right Content (Grid Items) --- %>
      <div class="w-full lg:w-3/4">
        
        <%# „Çø„Ç§„Éà„É´„Ç®„É™„Ç¢ %>
        <div class="flex justify-between items-end mb-4 sm:mb-6">
          <h2 class="text-xl sm:text-2xl font-bold text-indigo-950" style="font-family: 'Shippori Mincho', serif;">
            <% if params[:category_id] && cat = Category.find_by(id: params[:category_id]) %>
              <%= cat.name %>
            <% else %>
              „Ç¢„Ç§„ÉÜ„É†‰∏ÄË¶ß
            <% end %>
          </h2>
          <span class="text-slate-500 text-xs sm:text-sm bg-white px-3 py-1 rounded-full shadow-sm border border-slate-100">
            ÂÖ® <span class="font-bold text-indigo-900"><%= @items.count %></span> ‰ª∂
          </span>
        </div>

        <% if @items.any? %>
          <%# „Ç¢„Ç§„ÉÜ„É†„Ç∞„É™„ÉÉ„ÉâÔºö„Çπ„Éû„Éõ(„Éá„Éï„Ç©„É´„Éà)„ÅØ grid-cols-1 „Åß1ÂàóË°®Á§∫ %>
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 sm:gap-8">
            <% @items.each do |item| %>
              <%# „Çπ„Éû„Éõ„ÅßË¶ã„ÇÑ„Åô„ÅÑ„Çà„ÅÜ„ÄÅshadow„ÇíÂ∞ë„ÅóÂº∑„ÇÅ„Å´„Åó„ÄÅ„Éû„Éº„Ç∏„É≥„ÇíÁ¢∫‰øù %>
              <div class="group bg-white rounded-3xl overflow-hidden shadow-md hover:shadow-xl transition duration-300 border border-slate-100 flex flex-col h-full ring-1 ring-transparent hover:ring-amber-200">
                
                <%# ÁîªÂÉè„Ç®„É™„Ç¢Ôºö„Çπ„Éû„Éõ„Åß„ÇÇÂ§ß„Åç„ÅèË¶ã„Åõ„Çã %>
                <div class="relative aspect-[3/4] sm:aspect-[3/4] bg-slate-100 overflow-hidden">
                  <% if item.image.attached? %>
                    <%= image_tag item.image, class: "w-full h-full object-cover group-hover:scale-105 transition duration-700 ease-out" %>
                  <% else %>
                    <div class="flex flex-col items-center justify-center h-full text-slate-300">
                      <svg class="w-16 h-16 mb-2 opacity-30" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                      <span class="text-xs font-bold tracking-widest opacity-50">NO IMAGE</span>
                    </div>
                  <% end %>

                  <%# „É™„É≥„ÇØÔºàÁîªÂÉèÂÖ®‰Ωì„Çí„ÇØ„É™„ÉÉ„ÇØÂèØËÉΩ„Å´Ôºâ %>
                  <%= link_to "", item_path(item), class: "absolute inset-0 z-10" %>

                  <%# Â∑¶‰∏ä„ÅÆ„Ç´„ÉÜ„Ç¥„É™„É©„Éô„É´ %>
                  <% if item.category %>
                    <div class="absolute top-3 left-3 z-20 pointer-events-none">
                       <span class="inline-block bg-white/95 backdrop-blur-sm text-slate-700 text-xs px-3 py-1 rounded-full font-bold shadow-sm">
                        <%= item.category.name %>
                      </span>
                    </div>
                  <% end %>
                </div>

                <%# „ÉÜ„Ç≠„Çπ„ÉàÊÉÖÂ†±„Ç®„É™„Ç¢ %>
                <div class="p-5 flex flex-col flex-grow relative">
                  <%# Ë©≥Á¥∞„É™„É≥„ÇØÔºà„Çø„Ç§„Éà„É´Áî®Ôºâ %>
                  <%= link_to item.name, item_path(item), class: "block font-bold text-lg text-indigo-950 mb-2 line-clamp-1 hover:text-amber-700 transition stretched-link" %>
                  
                  <div class="mt-auto flex justify-between items-end border-t border-slate-50 pt-3">
                    <p class="text-xs text-slate-400">
                      <%= item.created_at.strftime('%Y.%m.%d') %>
                    </p>
                    <% if item.price.present? %>
                      <p class="text-lg font-bold text-slate-700 font-mono">
                        ¬•<%= item.price.to_fs(:delimited) %>
                      </p>
                    <% end %>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        <% else %>
           <%# „Ç¢„Ç§„ÉÜ„É†„Åå„Å™„ÅÑÂ†¥Âêà %>
           <div class="bg-white rounded-3xl p-10 text-center border-2 border-dashed border-slate-200">
             <p class="text-slate-400 font-bold mb-4">Ë°®Á§∫„Åô„Çã„Ç¢„Ç§„ÉÜ„É†„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>
             <%= link_to "Êù°‰ª∂„Çí„É™„Çª„ÉÉ„Éà", items_path, class: "text-amber-600 font-bold hover:underline" %>
           </div>
        <% end %>
        
      </div>
    </div>
  </main>
</div>

<%# --- Script for Mobile Filter Toggle --- %>
<script>
  function toggleMobileFilter() {
    const filterSection = document.getElementById('filter-section');
    if (filterSection.classList.contains('hidden')) {
      filterSection.classList.remove('hidden');
    } else {
      filterSection.classList.add('hidden');
    }
  }
</script>

<style>
/* „Çπ„Éû„Éõ„Åß„ÅÆ„Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥Ê®™„Çπ„ÇØ„É≠„Éº„É´„Éê„Éº„ÇíÈö†„Åô */
.no-scrollbar::-webkit-scrollbar {
  display: none;
}
.no-scrollbar {
  -ms-overflow-style: none;
  scrollbar-width: none;
}
</style>